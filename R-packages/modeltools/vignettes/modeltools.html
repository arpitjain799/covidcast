<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Get started with modeltools</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Get started with <code>modeltools</code></h1>



<p>This package provides tools for building COVID-19 statistical models, with an emphasis on short-term forecasting and hotspot prediction. It is designed to be used in conjunction with the <a href="https://cmu-delphi.github.io/covidcast/covidcastR/"><code>covidcast</code></a> and <a href="https://cmu-delphi.github.io/covidcast/evalcastR/"><code>evalcast</code></a> <tt>R</tt> packages, which are also developed and maintained by the <a href="https://delphi.cmu.edu">Delphi research group</a> (headquartered at Carnegie Mellon University).</p>
<div id="installing" class="section level2">
<h2>Installing</h2>
<blockquote>
<p><strong><em>Warning</em>: This package is not on CRAN! An <tt>R</tt> package named <code>modeltools</code> does exist on CRAN, but it is entirely unrelated to this one.</strong></p>
</blockquote>
<p>Our package is available on the Delphi research group’s <a href="https://github.com/cmu-delphi">GitHub page</a> and can be installed using the <a href="https://cran.r-project.org/package=devtools"><code>devtools</code></a> package, as shown below.</p>
<div id="installing-with-vignettes" class="section level3">
<h3>Installing with vignettes</h3>
<p>If you wish to install <code>modeltools</code> with the tutorial vignettes (such as this <em>Getting started</em> guide) included (encouraged), then use the command below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">&quot;cmu-delphi/covidcast&quot;</span>, <span class="at">ref =</span> <span class="st">&quot;collin-develop&quot;</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">subdir =</span> <span class="st">&quot;R-packages/modeltools&quot;</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">build_vignettes =</span> <span class="cn">TRUE</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="installing-without-vignettes" class="section level3">
<h3>Installing without vignettes</h3>
<p>Building the <code>modeltools</code> vignettes adds some time to the package installation. If you wish to avoid this, you can install the vignette-less package with the following command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">&quot;cmu-delphi/covidcast&quot;</span>, <span class="at">ref =</span> <span class="st">&quot;collin-develop&quot;</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">subdir =</span> <span class="st">&quot;R-packages/modeltools&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="downloading-data-from-the-covidcast-api" class="section level2">
<h2>Downloading data from the <code>covidcast</code> API</h2>
<p>For this <em>Getting started</em> vignette, we will fetch U.S. COVID-19 case rates — both raw and smoothed with 7-day trailing averages — from the <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast_signals.html">Delphi API</a>. These particular COVID-19 data signals are reported by the <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/usa-facts.html"><em>USAFacts</em></a> data source and then cloned into the Delphi API. Here, we will download the signals at the state level for four states over the time window June 1, 2020 to November 15, 2020.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(covidcast)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>start_day <span class="ot">&lt;-</span> <span class="st">&quot;2020-06-01&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>end_day <span class="ot">&lt;-</span> <span class="st">&quot;2020-11-15&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>geo_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ca&quot;</span>, <span class="st">&quot;fl&quot;</span>, <span class="st">&quot;ny&quot;</span>, <span class="st">&quot;tx&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>signals <span class="ot">&lt;-</span> <span class="fu">covidcast_signals</span>(<span class="at">data_source =</span> <span class="st">&quot;usa-facts&quot;</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">signal =</span> <span class="fu">c</span>(<span class="st">&quot;confirmed_incidence_prop&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;confirmed_7dav_incidence_prop&quot;</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">start_day =</span> start_day,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">end_day =</span> end_day,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">geo_type =</span> <span class="st">&quot;state&quot;</span>, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">geo_values =</span> geo_values)</span></code></pre></div>
<p>By default, the <code>covidcast_signals()</code> function returns the specified signals as a list of <code>covidcast_signal</code> data frames, with one data frame for each signal. So, in this case, <code>signals</code> is a list of two <code>covidcast_signal</code> data frames — the first being the raw COVID-19 case rates and the second being the COVID-19 case rates after smoothing with a 7-day trailing average. The <code>summary()</code> function can be called on each of these <code>covidcast_signal</code> data frames as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(signals[[<span class="dv">1</span>]])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A `covidcast_signal` dataframe with 672 rows and 12 columns.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## data_source : usa-facts</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## signal      : confirmed_incidence_prop</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## geo_type    : state</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## first date                          : 2020-06-01</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## last date                           : 2020-11-15</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## median number of geo_values per day : 4</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(signals[[<span class="dv">2</span>]])</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## A `covidcast_signal` dataframe with 672 rows and 12 columns.</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## data_source : usa-facts</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## signal      : confirmed_7dav_incidence_prop</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="do">## geo_type    : state</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">## first date                          : 2020-06-01</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## last date                           : 2020-11-15</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="do">## median number of geo_values per day : 4</span></span></code></pre></div>
<p>Taking a peek at the first 5 rows of each of the two <code>covidcast_signal</code> data frames in the list:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>signals[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(data_source, signal, geo_value, time_value, value) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;U.S. COVID-19 case rates (raw)&quot;</span>)</span></code></pre></div>
<table>
<caption>
U.S. COVID-19 case rates (raw)
</caption>
<thead>
<tr>
<th style="text-align:center;">
data_source
</th>
<th style="text-align:center;">
signal
</th>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_incidence_prop
</td>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.337
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_incidence_prop
</td>
<td style="text-align:center;">
fl
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
3.106
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_incidence_prop
</td>
<td style="text-align:center;">
ny
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
4.837
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_incidence_prop
</td>
<td style="text-align:center;">
tx
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
2.042
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_incidence_prop
</td>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
5.856
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>signals[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(data_source, signal, geo_value, time_value, value) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="st">&quot;html&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;U.S. COVID-19 case rates (7-day trailing average)&quot;</span>)</span></code></pre></div>
<table>
<caption>
U.S. COVID-19 case rates (7-day trailing average)
</caption>
<thead>
<tr>
<th style="text-align:center;">
data_source
</th>
<th style="text-align:center;">
signal
</th>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_7dav_incidence_prop
</td>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.701
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_7dav_incidence_prop
</td>
<td style="text-align:center;">
fl
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
3.381
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_7dav_incidence_prop
</td>
<td style="text-align:center;">
ny
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.570
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_7dav_incidence_prop
</td>
<td style="text-align:center;">
tx
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
4.406
</td>
</tr>
<tr>
<td style="text-align:center;">
usa-facts
</td>
<td style="text-align:center;">
confirmed_7dav_incidence_prop
</td>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
6.389
</td>
</tr>
</tbody>
</table>
</div>
<div id="sliding" class="section level2">
<h2>Sliding</h2>
<p>One of the most basic tools in the <code>modeltools</code> package is the <code>slide_by_geo()</code> function which is based on the family of functions provided by the <code>slider</code> package.</p>
<blockquote>
<p><strong>Definition: In <code>modeltools</code>, to <em>slide</em> means that, for each <code>geo_value</code>, we apply a user-specified function or formula over a trailing window of <code>n</code> days of data.</strong></p>
</blockquote>
<p>Many other functions in this package, such as <code>pct_change()</code> and <code>estimate_deriv()</code>, use <code>slide_by_geo()</code> as their workhorse.</p>
<div id="sliding-with-a-formula" class="section level3">
<h3>Sliding with a formula</h3>
<div id="example-1-computing-a-7-day-trailing-average-by-sliding-a-formula-over-the-raw-data" class="section level4">
<h4>Example 1: Computing a 7-day trailing average by sliding a formula over the raw data</h4>
<p>For example, to apply a 7-day trailing average to the raw values in the first <code>covidcast_signal</code> data frame fetched above (i.e. <code>signals[[1]]</code>), we can specify a formula via the <code>slide_fun</code> argument of <code>slide_by_geo()</code>, as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeltools)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">slide_by_geo</span>(signals[[<span class="dv">1</span>]], <span class="at">slide_fun =</span> <span class="sc">~</span> <span class="fu">Mean</span>(.x<span class="sc">$</span>value), <span class="at">n =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_value, time_value, value, slide_value) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(geo_value) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;U.S. COVID-19 case rates (7-day trailing average&quot;</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;computed by sliding a formula)&quot;</span>))</span></code></pre></div>
<table>
<caption>
U.S. COVID-19 case rates (7-day trailing average computed by sliding a formula)
</caption>
<thead>
<tr>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value
</th>
<th style="text-align:center;">
slide_value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.337
</td>
<td style="text-align:center;">
6.337
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
5.856
</td>
<td style="text-align:center;">
6.097
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-03
</td>
<td style="text-align:center;">
5.884
</td>
<td style="text-align:center;">
6.026
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-04
</td>
<td style="text-align:center;">
7.970
</td>
<td style="text-align:center;">
6.512
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-05
</td>
<td style="text-align:center;">
8.397
</td>
<td style="text-align:center;">
6.889
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-06
</td>
<td style="text-align:center;">
6.712
</td>
<td style="text-align:center;">
6.859
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-07
</td>
<td style="text-align:center;">
6.031
</td>
<td style="text-align:center;">
6.741
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-08
</td>
<td style="text-align:center;">
6.418
</td>
<td style="text-align:center;">
6.753
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-09
</td>
<td style="text-align:center;">
7.539
</td>
<td style="text-align:center;">
6.993
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-10
</td>
<td style="text-align:center;">
7.271
</td>
<td style="text-align:center;">
7.191
</td>
</tr>
</tbody>
</table>
<p>The formula specified by <code>slide_fun</code> has access to all columns present in the original <code>covidcast_signal</code> data frame, and must be referred to with the prefix <code>.x$</code>. Here, the function <code>modeltools::Mean()</code> is a simple wrapper around <code>mean()</code> that omits <code>NA</code> values by default.</p>
<p>Notice that the above <code>slide_by_geo()</code> call returns a data frame with a new column appended containing the results of the sliding operation specified by <code>slide_fun</code>. By default, this column is named <code>&quot;slide_value&quot;</code>, but alternative namings can be used by passing a string to the <code>col_name</code> argument in the original <code>slide_by_geo()</code> function call. For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slide_by_geo</span>(signals[[<span class="dv">1</span>]], <span class="at">slide_fun =</span> <span class="sc">~</span> <span class="fu">Mean</span>(.x<span class="sc">$</span>value), <span class="at">n =</span> <span class="dv">7</span>, <span class="at">col_name =</span> <span class="st">&quot;7dav&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_value, time_value, value, <span class="st">`</span><span class="at">7dav</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(geo_value) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;U.S. COVID-19 case rates (7-day trailing average &quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;computed by sliding a formula)&quot;</span>))</span></code></pre></div>
<table>
<caption>
U.S. COVID-19 case rates (7-day trailing average computed by sliding a formula)
</caption>
<thead>
<tr>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value
</th>
<th style="text-align:center;">
7dav
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.337
</td>
<td style="text-align:center;">
6.337
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
5.856
</td>
<td style="text-align:center;">
6.097
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-03
</td>
<td style="text-align:center;">
5.884
</td>
<td style="text-align:center;">
6.026
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-04
</td>
<td style="text-align:center;">
7.970
</td>
<td style="text-align:center;">
6.512
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-05
</td>
<td style="text-align:center;">
8.397
</td>
<td style="text-align:center;">
6.889
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-06
</td>
<td style="text-align:center;">
6.712
</td>
<td style="text-align:center;">
6.859
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-07
</td>
<td style="text-align:center;">
6.031
</td>
<td style="text-align:center;">
6.741
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-08
</td>
<td style="text-align:center;">
6.418
</td>
<td style="text-align:center;">
6.753
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-09
</td>
<td style="text-align:center;">
7.539
</td>
<td style="text-align:center;">
6.993
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-10
</td>
<td style="text-align:center;">
7.271
</td>
<td style="text-align:center;">
7.191
</td>
</tr>
</tbody>
</table>
<p>As a simple sanity check, below we compare the 7-day trailing average computed via <code>slide_by_geo()</code> to the values of the smoothed signal from the Delphi API to ensure that they match (to machine precision). More specifically, the code chunk below computes the maximum absolute difference between the two 7-day trailing averages of the COVID-19 case rates signal, over all state-date pairs.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slide_by_geo</span>(signals[[<span class="dv">1</span>]], <span class="at">slide_fun =</span> <span class="sc">~</span> <span class="fu">Mean</span>(.x<span class="sc">$</span>value), <span class="at">n =</span> <span class="dv">7</span>, <span class="at">col_name =</span> <span class="st">&quot;7dav&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(signals[[<span class="dv">2</span>]], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;geo_value&quot;</span>, <span class="st">&quot;time_value&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> <span class="st">`</span><span class="at">7dav</span><span class="st">`</span> <span class="sc">-</span> value.y) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_value <span class="sc">&gt;=</span> <span class="st">&quot;2020-06-07&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">max</span>(<span class="fu">abs</span>(difference))) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  as.numeric</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 6.757779e-08</span></span></code></pre></div>
<p>The trivially small output of this sanity check confirms that <code>slide_by_geo()</code> is functioning as desired.</p>
<p><strong>Note:</strong> This sanity check would <em>fail</em> without filtering the dates to <code>&gt;= &quot;2020-06-07&quot;</code> because the Delphi API has access to data before June 1, 2020, and can therefore return the 7-day trailing average of COVID-19 case rates <em>for all</em> days in the time window June 1, 2020 to November 15, 2020. On the other hand, since we are only providing <code>slide_by_geo()</code> with daily COVID-19 case rates beginning on June 1, 2020, the “7-day trailing average” computed by <code>slide_by_geo()</code> does not become a true <em>7-day average</em> until June 7, 2020. When a trailing window of <code>n</code> days is not available, <code>slide_by_geo()</code> just applies the function or formula to whatever data is available. So the “7-day trailing average” computed by <code>slide_by_geo()</code> for the dates June <code>n</code>th where <code>n = 1,...,6</code>, is actually just an <code>n</code>-day trailing average of the daily COVID-19 case rates.</p>
</div>
</div>
<div id="sliding-with-a-function" class="section level3">
<h3>Sliding with a function</h3>
<p>We can also pass a function to the <code>slide_fun</code> argument in <code>slide_by_geo()</code>. In this case, the passed function must have the following input argument structure:</p>
<ol style="list-style-type: decimal">
<li><p><code>x</code> : a data frame with the same column names as the data frame passed to <code>slide_by_geo()</code></p></li>
<li><p>Any number of additional <strong>named</strong> arguments</p></li>
<li><p>An ellipsis <code>...</code> to allow for any number of additional general arguments</p></li>
</ol>
<div id="example-2-computing-a-7-day-trailing-average-by-sliding-a-function-over-the-raw-data" class="section level4">
<h4>Example 2: Computing a 7-day trailing average by sliding a function over the raw data</h4>
<p>The code chunk below recreates <a href="#example-1-computing-a-7-day-trailing-average-by-sliding-a-formula-over-the-raw-data">Example 1</a>, but passes a function to the <code>slide_fun</code> argument instead of a formula.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slide_by_geo</span>(signals[[<span class="dv">1</span>]], <span class="at">slide_fun =</span> <span class="cf">function</span>(x, ...) <span class="fu">Mean</span>(x<span class="sc">$</span>value), <span class="at">n =</span> <span class="dv">7</span>, <span class="at">col_name =</span> <span class="st">&quot;7dav&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_value, time_value, value, <span class="st">`</span><span class="at">7dav</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(geo_value) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;U.S. COVID-19 case rates (7-day trailing average computed by sliding&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;a function)&quot;</span>))</span></code></pre></div>
<table>
<caption>
U.S. COVID-19 case rates (7-day trailing average computed by sliding a function)
</caption>
<thead>
<tr>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value
</th>
<th style="text-align:center;">
7dav
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
6.337
</td>
<td style="text-align:center;">
6.337
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
5.856
</td>
<td style="text-align:center;">
6.097
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-03
</td>
<td style="text-align:center;">
5.884
</td>
<td style="text-align:center;">
6.026
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-04
</td>
<td style="text-align:center;">
7.970
</td>
<td style="text-align:center;">
6.512
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-05
</td>
<td style="text-align:center;">
8.397
</td>
<td style="text-align:center;">
6.889
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-06
</td>
<td style="text-align:center;">
6.712
</td>
<td style="text-align:center;">
6.859
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-07
</td>
<td style="text-align:center;">
6.031
</td>
<td style="text-align:center;">
6.741
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-08
</td>
<td style="text-align:center;">
6.418
</td>
<td style="text-align:center;">
6.753
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-09
</td>
<td style="text-align:center;">
7.539
</td>
<td style="text-align:center;">
6.993
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-10
</td>
<td style="text-align:center;">
7.271
</td>
<td style="text-align:center;">
7.191
</td>
</tr>
</tbody>
</table>
</div>
<div id="example-3-advanced" class="section level4">
<h4>Example 3 (advanced):</h4>
<p>As a more sophisticated example, here we show how to <em>sensorize</em> the doctor visits signal. The sensor values are defined by the predicted values from a local (in time) regression of past case rates (response) on past doctor visits (covariate).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression for doctor visits sensorization</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dv_regression <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">m =</span> <span class="dv">3</span>, ...) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( n <span class="sc">&lt;=</span> m <span class="sc">+</span> <span class="dv">1</span> ) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># Take care of trivial case</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tryCatch</span>(<span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>({</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a regression, leaving out the last m days of data</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    lm_obj <span class="ot">&lt;-</span> <span class="fu">lm</span>(value.y <span class="sc">~</span> value.x, <span class="at">data =</span> x[<span class="dv">1</span><span class="sc">:</span>(n<span class="sc">-</span>m<span class="sc">+</span><span class="dv">1</span>), ])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Form prediction for the last day of data, and return</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(lm_obj, <span class="at">newdata =</span> x[n, ])</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  })),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">return</span>(<span class="cn">NA</span>)))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch doctor visits signal and join it to case rates</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> <span class="fu">covidcast_signal</span>(<span class="at">data_source =</span> <span class="st">&quot;doctor-visits&quot;</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">signal =</span> <span class="st">&quot;smoothed_adj_cli&quot;</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">start_day =</span> start_day, </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">end_day =</span> end_day,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">geo_type =</span> <span class="st">&quot;state&quot;</span>, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">geo_values =</span> geo_values) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(signals[[<span class="dv">2</span>]], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;geo_value&quot;</span>, <span class="st">&quot;time_value&quot;</span>))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform sensorization for each state; use the last n = 56 days (8 weeks) of </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># data, minus the last m = 3 days, for the regression</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">slide_by_geo</span>(joined, <span class="at">slide_fun =</span> dv_regression, <span class="at">n =</span> <span class="dv">56</span>, <span class="at">m =</span> <span class="dv">3</span>, </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_name =</span> <span class="st">&quot;sensor&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_value, time_value, value.x, value.y, sensor) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(geo_value) <span class="sc">%&gt;%</span> </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:center;">
geo_value
</th>
<th style="text-align:center;">
time_value
</th>
<th style="text-align:center;">
value.x
</th>
<th style="text-align:center;">
value.y
</th>
<th style="text-align:center;">
sensor
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-01
</td>
<td style="text-align:center;">
2.754
</td>
<td style="text-align:center;">
6.701
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-02
</td>
<td style="text-align:center;">
2.589
</td>
<td style="text-align:center;">
6.389
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-03
</td>
<td style="text-align:center;">
2.480
</td>
<td style="text-align:center;">
6.497
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-04
</td>
<td style="text-align:center;">
2.412
</td>
<td style="text-align:center;">
6.863
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-05
</td>
<td style="text-align:center;">
2.571
</td>
<td style="text-align:center;">
7.109
</td>
<td style="text-align:center;">
6.498
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-06
</td>
<td style="text-align:center;">
2.630
</td>
<td style="text-align:center;">
6.808
</td>
<td style="text-align:center;">
6.594
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-07
</td>
<td style="text-align:center;">
2.726
</td>
<td style="text-align:center;">
6.741
</td>
<td style="text-align:center;">
6.682
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-08
</td>
<td style="text-align:center;">
3.045
</td>
<td style="text-align:center;">
6.753
</td>
<td style="text-align:center;">
6.683
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-09
</td>
<td style="text-align:center;">
2.969
</td>
<td style="text-align:center;">
6.993
</td>
<td style="text-align:center;">
6.709
</td>
</tr>
<tr>
<td style="text-align:center;">
ca
</td>
<td style="text-align:center;">
2020-06-10
</td>
<td style="text-align:center;">
2.985
</td>
<td style="text-align:center;">
7.191
</td>
<td style="text-align:center;">
6.738
</td>
</tr>
</tbody>
</table>
<p>Above, the first 4 elements are <code>NA</code> because of insufficient training data (we need at least 2 training samples for simple linear regression, and we omit the last 3 days of data).</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
